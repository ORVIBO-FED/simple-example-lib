<!DOCTYPE>
<html>
<head>
    <title>åˆ›å»ºæ—¥åŽ†</title>
</head>

<body>
ðŸ˜‚ï¼šconsole æŸ¥çœ‹
<script src="https://unpkg.com/dayjs"></script>
<script>
  /**
   * ç”Ÿæˆæœªæ¥8å¤©çš„æ—¶é—´è¡¨
   * @return {Array}
   */
  function createEightDayList() {
    const current = dayjs();

    // å»ºç«‹æœªæ¥8å¤©çš„è¡¨
    //è¿‡æ»¤å‡ºæ—¶é—´æœ‰æ•ˆçš„ï¼Œå³æœªæ¥çš„
    return Array.from({length: 8}).map((item, index) => {
      const date = current.add(index, "day");
      let day = date.day();
      if (day === 0) day = 7;
      return {
        day,
        date: date.format("YYYY/MM/DD"),
        time: [],
      };
    })
  }

  /**
   * åˆ›å»ºæ—¥åŽ†
   * @param allWeekAndTime
   * @param missionWeekAndTime
   */
  function checkIfTimeOverlap(allWeekAndTime, missionWeekAndTime) {
    const current = dayjs();
    const currentTimestamp = current.valueOf();
    const currentDate = current.format("YYYY/MM/DD");
    const currentTime = current.format("hh:mm:ss");

    // æ ¡éªŒ
    if (allWeekAndTime.some(item => !Array.isArray(item.week) || !item.time.match(/^\d{2}\:\d{2}$/))) {
      console.error("å‚æ•°1æ•°ç»„é”™è¯¯ï¼Œå…ƒç´ å¿…é¡»è¦æœ‰ week å’Œ time ä¸¤ä¸ªå±žæ€§ï¼Œä¸”å¿…é¡»æ˜¯æ•°ç»„å’Œæ—¶é—´å­—ç¬¦ä¸²ã€‚å‚æ•°1ï¼š\n", allWeekAndTime);
      return;
    }
    if (typeof missionWeekAndTime !== "object" || !missionWeekAndTime.time || !missionWeekAndTime.week) {
      console.error("å‚æ•°2å¯¹è±¡é”™è¯¯ï¼Œå¯¹è±¡å¿…é¡»è¦æœ‰ week å’Œ time ä¸¤ä¸ªå±žæ€§ï¼Œä¸”å¿…é¡»æ˜¯æ•°ç»„å’Œæ—¶é—´å­—ç¬¦ä¸²ã€‚å‚æ•°2ï¼š\n", missionWeekAndTime)
    }

    // å›ºå®šå®šæ—¶
    const calender = createEightDayList();
    calender.forEach(calenderItem => {
      allWeekAndTime.forEach(arrItem => {
        // æ—¶é—´é›†ä¸­åˆ°dayä¸­
        if (arrItem.week.find(item => item === calenderItem.day)) {
          calenderItem.time.push(arrItem.time);
        }
      })
    });

    // æ—¶é—´æˆ³åˆ—è¡¨é“ºå¹³
    let allTimestampList = [];
    calender.forEach(item => {
      item.time.map(subItem => {
        const dateAndTimeStr = `${item.date} ${subItem}`;
        allTimestampList.push(dayjs(dateAndTimeStr).valueOf())
      })
    });
    allTimestampList = Array.from(new Set(allTimestampList)); // åŽ»é‡

    // å•æ¬¡å®šæ—¶
    if (missionWeekAndTime.week.length === 0) {
      // å¦‚æžœæ—¶é—´è¿‡åŽ»äº†ï¼Œé‚£å°±æ˜¯æ˜Žå¤©çš„ä»»åŠ¡ï¼Œæœªè¿‡åŽ»å°±æ˜¯ä»Šå¤©çš„ä»»åŠ¡
      const todayMissionTimestamp = dayjs(currentDate + " " + missionWeekAndTime.time).valueOf();
      const tomorrowMissionTimestamp = dayjs(
        current.add(1, "day").format("YYYY/MM/DD") + " " + missionWeekAndTime.time
      ).valueOf();

      const missionTimestamp = todayMissionTimestamp > currentTimestamp
        ? todayMissionTimestamp
        : tomorrowMissionTimestamp;
      // åˆ¤æ–­
      return allTimestampList.indexOf(missionTimestamp) > -1;
    }

    // å¤šæ¬¡ä»»åŠ¡
    // åœ¨æ—¥åŽ†ä¸­æ¯”è¾ƒ
    return calender.some(item => {
      if (missionWeekAndTime.week.find(day => day === item.day)) {
        return item.time.indexOf(missionWeekAndTime.time) > -1;
      }
    });
  }

  // æµ‹è¯•
  const allWeekAndTime = [
    {week: [1, 2, 3, 4, 5, 6, 7], time: "00:00"},
    {week: [1, 2, 3, 4, 5, 6, 7], time: "12:00"},
    {week: [5, 6, 7], time: "12:00"},
    {week: [1, 2, 3], time: "10:00"},
    {week: [3, 4], time: "01:00"},
    {week: [5, 6], time: "00:10"},
    {week: [3], time: "00:01"},
    {week: [7], time: "12:00"},
    {week: [1], time: "00:01"},
    {week: [], time: "11:11"},
  ];

  //const allWeekAndTime = [];

  const missionList = [
    // å•æ¬¡
    {time: "09:00", week: []},
    {time: "10:00", week: []},
    {time: "12:00", week: []},
    {time: "12:01", week: []},
    {time: "00:01", week: []},
    {time: "01:00", week: []},
    {time: "13:00", week: []},
    // å¤šæ¬¡
    {time: "13:00", week: [1, 2, 3]},
    {time: "12:00", week: [1, 2, 3]},
    {time: "12:00", week: [6]},
    {time: "12:01", week: [1, 2, 3]},
    {time: "10:00", week: [3]},
    {time: "10:00", week: [4]},
  ];

  missionList.forEach(item => {
    const res = checkIfTimeOverlap(allWeekAndTime, item);
    console.log(JSON.stringify(item), res);
  })
</script>
</body>
</html>
