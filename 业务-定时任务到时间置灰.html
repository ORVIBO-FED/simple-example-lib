<!DOCTYPE>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ä»»åŠ¡åˆ—è¡¨</title>
    <style>
        .time-status {
            display: inline;
            margin-left: 10px;
        }
    </style>
</head>
<ul class="time">
</ul>
<body>
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script src="https://unpkg.com/dayjs"></script>
<script>
  const list = [];
  const LIST_LEN = 800;

  function createMissionList() {
    const cur = dayjs();
    // ç”Ÿæˆä»»åŠ¡
    let last = cur;
    for (let i = 0; i < LIST_LEN; i++) {
      last = last.add(1, "minute");
      const item = {
        index: i,
        time: last.format("HH:mm"),
        status: true
      };
      item.check = checkIfTimeout.call(item);
      list.push(item);
    }
  }

  /**
   * æ¸²æŸ“å…¨éƒ¨åˆ—è¡¨
   */
  function renderAll() {
    const $missionList = $(".time");
    const liTlp = function (time, active) {
      return `<li>
                <span>${time}</span>
                <div class="time-status">
                    ${active ? 'â˜‘ï¸' : 'ğŸš«'}
                </div>
              </li>`
    };
    // æ¸²æŸ“
    let allEleStr = "";
    list.forEach((item, index) => {
      allEleStr += liTlp(item.time, item.status);
    });
    $missionList.append(allEleStr);
  }

  /**
   * è®¾ç½®ä¸€ä¸ªä»»åŠ¡çš„çŠ¶æ€
   * @param index
   * @param status
   */
  function setMission(index, status) {
    const $status = $(".time li").eq(index).find(".time-status");
    $status.text(status ? 'â˜‘ï¸' : 'ğŸš«');
  }

  let cnt = 0; // æ—¶é—´åŠ é€Ÿè®¡æ•°
  const RATE = 3; // ä¸€æ¬¡å³æ—¶é‡‡æ ·å¤šå°‘æ¬¡
  const baseTime = function () {
    cnt++;
    return dayjs().add(parseInt(cnt / LIST_LEN / RATE), "minute");
  };

  function checkIfTimeout() {
    const TIME_GAP = 1200; // å¤§äº 1sï¼Œé¿å…æ£€æµ‹åˆ°ä¸¤æ¬¡åŒä¸€æ—¶åˆ»
    // æ—¶é—´æ˜¯"è¿›å…¥"çš„
    const curDate = dayjs().format("YYYY-MM-DD");
    const missionTime = dayjs(`${curDate} ${this.time}`);
    const missionPattern = [missionTime.subtract(1, "minute").format("HH:mm"), this.time]; // ["12:12","12:13"]

    let lastTime = "";
    let curTime = "";
    return setInterval(() => {
      if (this.status) {        // æ—¶é—´è¿›å…¥ä»»åŠ¡ï¼Œç½®ç°
        lastTime = curTime;
        curTime = baseTime().format("HH:mm");
        if (this.index === LIST_LEN - 1) console.log(curTime, missionPattern); // æ‰“å°ä¸€æ¬¡è¶³å¤Ÿ
        if (lastTime === missionPattern[0] && curTime === missionPattern[1]) {
          this.status = false;
          clearInterval(this.check);
          setMission(this.index, this.status);
        }
      }
    }, TIME_GAP / 60); // åŠ é€Ÿåï¼Œéœ€è¦åŠ å¤šé‡‡æ ·ç‡
  }

  // æ‰§è¡Œ
  createMissionList();
  renderAll();
  console.log(list);
</script>
</body>
</html>
